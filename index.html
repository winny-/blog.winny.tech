<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="alternate"
      type="application/rss+xml"
      href="https://blog.winny.tech/rss.xml"
      title="RSS feed for https://blog.winny.tech/"/>
<title>blog.winny.tech</title>

<link href="static/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="preamble" class="status">
<nav>
blog.winny.tech :: <ul>
<li><a href=".">Home</a></li>
<li><a href="archive.html">Archive</a></li>
<li><a href="tags.html">Tags</a></li>
<li><a href="rss.xml">RSS Feed</a></li>
</ul>
</nav>
<hr/>
</div>
<div id="content">

<div class="post-date">02 Aug 2019</div><h1 class="post-title"><a href="2019-08-02-the-danger-of-fuzzy-matching-over-ones-path.html">The Danger of fuzzy matching over one's PATH</a></h1>
<p>
Awhile back I noticed my personal <code>mnt/</code> directory, my (empty) personal
<code>tmp/</code> directory, and a few symbolic links disappeared from my home
directory. I only noticed because I use unison<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> to synchronize my
desktop and laptop homedirs. The actual amount of removed directories
and symbolic links were staggering, and it costed me five minutes of
extra effort to search through the unison UI to ignore files I don&rsquo;t
want to synchronize. Repeat this a few times a day, with the problem
occurring at seemingly random intervals, and you&rsquo;ve wasted minutes out
of every day, which adds up to hours every month.
</p>

<p>
For months I had not figured out what the problem was. By chance I had
noticed while using my application launcher, I had accidentally not
ran <code>links -g</code> <sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> but instead had ran <code>cleanlinks</code>. I wonder to myself
what was I running by accident, as I had done this before, but had not
thought anything of it, assuming it was a program that would print
usage or perform a no-operation by default.
</p>

<p>
I was wrong.
</p>

<p>
Turns out <code>cleanlinks</code> searches the current working directory for <b>empty</b>
directories and <b>broken</b> symbolic links. Both are useful. For example I
keep empty directories in <code>~/mnt/</code> to mount <code>sshfs</code> stuff, and I prefer to
use <code>~/tmp/</code> as a work directory because no system scripts will touch
it.<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> I had a few <b>broken</b> symbolic links scattered about, from
weird git repositories working trees to some stale user-level systemd
unit links from my archlinux install.
</p>

<p>
Making things more interesting, if you run <code>cleanlinks --help</code>, or with
any flags, it operates as usual. So it&rsquo;s a mistake to also do
<code>cleanlinks /some/directory/i/want/to/clean</code>. As a part of imake,<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup>
the old X11 ecosystem build tools, <code>cleanlinks</code> will be installed on
many systems and it&rsquo;s not safe to run it lest you enjoy random stuff
being messed about with in your current directory.
</p>

<p>
How did I manage to run <code>cleanlinks</code> so many times? I did not have links
installed on the affected machine. And even after I did install it, I
forgot to remove <code>cleanlinks</code> from my rofi runcache. So it had a higher
precedence to match than <code>links</code> in certain cases. Hence I ran it a few
times on accident even after installing links.
</p>

<p>
Therefore, I strongly recommend one doesn&rsquo;t fuzzy match over their
<code>PATH</code>. Who knows what other nasty tools ship on your system that will
lay waste your productivity, or worse, damage your personal files.
</p>

<p>
Regardless, I have yet to heed my own warning. Maybe I should just use
<code>.desktop</code> files, but then again, maybe there exists a
<code>cleanlinks.desktop</code>&#x2026; Ideally, I&rsquo;ll create a directory of  symlinks to
programs I want to launch from rofi. Someday :)
</p>

<div id="outline-container-orgb3d1b63" class="outline-2">
<h2 id="orgb3d1b63">About Unison</h2>
<div class="outline-text-2" id="text-orgb3d1b63">
<p>
I should mention unison is a superb tool for synchronizing your
data. It shows the user a list of changes to each directory being
synchronized, waits for the user to decide which way each file should
be synchronized:
</p>

<ol class="org-ol">
<li>Send file from host A to B</li>
<li>Send file from host B to A</li>
<li>Ignore the file this time</li>
<li>Ignore the file permanently</li>
<li>Merge the files</li>
</ol>

<p>
Because unison doesn&rsquo;t try to be fancy or automatic, it is easy to
understand what is happening.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.cis.upenn.edu/~bcpierce/unison/">Unison homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
Links 2 is the best web 1.0 browser. It even shows images and
different text sizes. Screenshots on <a href="http://links.twibright.com/features.php">this page</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<code>/var/tmp/</code> could also work, but this way I know nobody is gunna
mess with my files and I won&rsquo;t accidentally mess up permissions on
sensitive data.
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
<a href="https://gitlab.freedesktop.org/xorg/util/imake">imake on freedesktop&rsquo;s GitLab</a>. See also what packages depend on
imake <a href="https://www.archlinux.org/packages/extra/x86_64/imake/">in Arch Linux</a>. I use Gentoo across my laptop and workstation, so
it&rsquo;s necessary to have imake installed.
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags</a>: <a href="tag-computing.html">computing</a> <a href="tag-rant.html">rant</a> </div>
<div class="post-date">28 Jul 2019</div><h1 class="post-title"><a href="2019-07-28-open-url-in-existing-qutebrowser-from-emacs-daemon-on-gentoo.html">Open URL in existing Qutebrowser from Emacs Daemon on Gentoo</a></h1>
<p>
On my Gentoo desktops, I use Emacs Daemon via <code>sys-emacs/emacs-daemon</code><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
to ensure an Emacs instance is ready to go and always available from
boot. This is done via creating a symbolic link like
<code>/etc/init.d/emacs.winston</code> to <code>/etc/init.d/emacs</code> which will start Emacs
for the given user. See the package README for more details.
</p>

<p>
A shortcoming of this setup is <code>XDG_RUNTIME_DIR</code><sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> is not set, as this is
set by my Desktop Session - maybe LightDM or consolekit set this? As a
result, when I open a URL from Emacs Daemon, it opens a fresh
qutebrowser session, loading the saved default session, and making a
mess of my workflow.
</p>

<p>
One approach to fix this might be to instead run Emacs daemon from my
<code>.xsession</code> script, but I rather not supervise daemons at the user
level; if I were to consider this, I'd be better off to switch to
systemd for user-level services anyway.
</p>

<p>
The solution I came up with is to add some lines to my <code>init.el</code> to
ensure <code>XDG_RUNTIME_DIR</code> is set to the expected value:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">winny/ensure-XDG_RUNTIME_DIR</span> ()
  <span style="color: #da8b55;">"Ensure XDG_RUNTIME_DIR is set. Used by qutebrowser and other utilities."</span>
  (<span style="color: #3a81c3; font-weight: bold;">let</span> ((rd (getenv <span style="color: #2d9574;">"XDG_RUNTIME_DIR"</span>)))
    (<span style="color: #3a81c3; font-weight: bold;">when</span> (<span style="color: #3a81c3; font-weight: bold;">or</span> (not rd) (string-empty-p rd))
      (setenv <span style="color: #2d9574;">"XDG_RUNTIME_DIR"</span> (format <span style="color: #2d9574;">"/run/user/%d"</span> (user-uid))))))

(add-hook 'after-init-hook #'winny/ensure-XDG_RUNTIME_DIR)
</pre>
</div>

<p>
A strange emacs-ism: <code>(user-uid)</code> returns float or integer, despite the
backing <code>uid_t</code> (on *nix) is guarenteed to be an integer type. I'll just
assume this'll never return a float. Please contact me otherwise, I'd
love to hear about this.
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://packages.gentoo.org/packages/app-emacs/emacs-daemon">https://packages.gentoo.org/packages/app-emacs/emacs-daemon</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">freedesktop.org XDG Base Directory Specification</a>
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags</a>: <a href="tag-emacs.html">emacs</a> <a href="tag-productivity.html">productivity</a> <a href="tag-computing.html">computing</a> <a href="tag-gentoo.html">gentoo</a> <a href="tag-qutebrowser.html">qutebrowser</a> </div>
<div class="post-date">22 Jan 2019</div><h1 class="post-title"><a href="2019-01-22-blink-shell-first-thoughts.html">Blink Shell: First Thoughts</a></h1>
<p>
As a heavy user of SSH to manage computers and IRC via command line
clients, the most used application on my phone besides the web browser
is a SSH client. Previously I have used Prompt and it worked, but
barely. My issues with Prompt include crashing on emoji spam that is common
in certain IRC channels, very slow terminal rendering to the point
that watching the output of compiling a large package will cause
Prompt to lag uncontrollably for tens of seconds, and a relatively
un-intuitive UI. Please note I am referring to Prompt, not Prompt 2<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>,
which is another problem in itself (the idea I need to pay for the
same product but rewritten to actually work is just ludicrous).
</p>


<figure>
<img src="static/image/blink-thumb.png" alt="blink-thumb.png">

</figure>

<p>
Another thing to note before I dig into Blink is I'm not a big fan of
mobile devices. They get the job done, but in most cases I rather
crack open my netbook and not fight with the learn-by-fiddling mobile
UI paradigms most devices have adopted. I am also not a fan of Apple's
ecosystem, but I'm pretty content with my iPhone and iPad for my
basic use cases: browse the web, chat applications, making phone
calls, casual mobile gaming, logging into other computers via SSH.
</p>

<p>
Enter Blink<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>. This application does a few things differently from other
mobile SSH clients. It offers a command-line first user interface. At
first I thought this would be painful, but the application's verbs are
pretty simple and appear to match up with how one uses ssh and mosh in
a terminal emulator. The terminal emulator is responsive,
significantly more stable than Prompt, and looks good. I can even load
up my favorite font: Droid Sans Mono<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> (thanks to its support for
loading webfonts via a URL to a CSS file).
</p>

<p>
Another thing Blink does different is it offers
Mosh support<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup>. Mosh is an alternative to SSH that can "roam" across
networks and device power state changes. One thing to note is Mosh
requires SSH to make the initial login, then switches to Mosh which
uses a different protocol. When using mosh, I tend to log in once
throughout the day. I can then switch networks and mosh will
gracefully reconnect as soon as the server is reachable again. In
addition, when I sleep my netbook, the session isn't lost (but don't
go using this instead of tmux or screen). Instead when I wake my
netbook, it also gracefully reconnects to the server. The same is true
of Blink's Mosh support. It even appears to save state between
changing iOS application states, sans forcing the application to quit
(or rebooting your device). This means I only log in once on my phone
throughout the day, and the connection is gracefully dropped when the
app becomes inactive and reconnects when the app is opened again.
</p>

<p>
I did notice I crashed Blink after writing non-ascii binary data to
the terminal followed by some other operations, but did not manage to
reproduce the crash yet. If I do, I am confident I can report the bug
and get meaningful feedback too, as Blink has a bug tracker on
GitHub<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup>. The code is available under GPLv3 (but not to worry, as the
single copyright holder can safely relicense it to deploy on the iOS
App Store<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup>). I could probably build it myself and install that, but I
neither own a Mac (or wish to install Mac OS X in a VM) nor want to
ever open XCode again even if I had a way to. That life isn't for me.
Again, I'm very practical about how I use my iOS devices and don't
enjoy using them more than I have to, so I'm willing to pay $20 for
an application I'll use every day of my life on this walled garden
platform. An added silver lining is this investment
goes towards the development of such a great app that appears to have
active maintainership.
</p>

<p>
Note: I did not explore some of Blink's features such as using it a
local iOS shell or settings synchronization. YMMV.
</p>

<div id="outline-container-org6589066" class="outline-2">
<h2 id="org6589066">Getting started</h2>
<div class="outline-text-2" id="text-org6589066">
<p>
Here are the steps I used to get started with Blink, as it was
relatively unclear where to find documentation and which settings
are necessary to configure. Usage information can be
found via the <code>help</code> command, the README on GitHub<sup><a id="fnr.7" class="footref" href="#fn.7">7</a></sup>, and fiddling
with the UI.
</p>

<ol class="org-ol">
<li>Run the <code>config</code> command.
<ol class="org-ol">
<li>Default User -&gt; set to your preferred username on most of your servers</li>
<li>Add a new font via: Appearance -&gt; Add a new font. Open the
gallery and grab the raw CSS file (you can get a raw URL after
switching to GitHub desktop), then paste it into the URL
Address Field. I prefer Droid Sans Mono for its readability at
all sizes.</li>
<li><p>
Keys -&gt; + -&gt; Create New
</p>

<p>
Please use ssh keypair authentication. Password authentication
requires you to memorize a password to log in which can be
bruteforced or otherwise leaked when typing it in the wrong
context. Also, be sure to use a unique key on each of your
devices to make revocation easier when a device is no longer
used.
</p>

<p>
Note: it appears keys are always stored as plaintext,
which is acceptable for your uses, but it appears <code>ssh-keygen</code>
can create a key with a passphrase. I wasn't able to get Blink
to work with Passphrase protected keys, but I didn't try very
hard. YMMV.
</p>

<ul class="org-ul">
<li>Type: RSA</li>
<li>Bits: 4096 (why not?)</li>
<li>Name: <code>id_rsa</code></li>
</ul></li>
<li>Hosts -&gt; +
<ul class="org-ul">
<li>Host: the name you gave your host when running <code>ssh host</code> or
<code>mosh host</code>. This is not related to the server's hostname,
though it can be the same. I prefer simple names, usually
the hostname before the first dot (e.g. <code>worf.winny.tech</code>
becomes simply <code>worf</code>)</li>
<li>User: make sure this is correct</li>
<li>Key: select a key to use.</li>
</ul></li>
</ol></li>
<li>Now you need to install the SSH public key:
<ol class="org-ol">
<li>Run <code>config</code> again</li>
<li>Keys -&gt; <code>id_rsa</code> -&gt; Copy Public Key</li>
<li><p>
Install it some way.
</p>

<p>
I usually prefer to visit
<a href="https://ptpb.pw/f">https://ptpb.pw/f</a> and paste the public key, hit Paste, then
copy the url with the text of "created". You can then <code>curl
        https://ptpb.pw/PasteId</code> on the server via another login setup
(or ssh from a set up machine) and add it to your
<code>~/.ssh/authorized_keys</code>. Make sure that file is mode 0600
(<code>chmod 0600 ~/.ssh/authorized_keys</code>). Also make sure the
<code>.ssh</code> directory is 0700 (<code>chmod 0700 ~/.ssh</code>). OpenSSH
refuses to use <code>authorized_keys</code> if these permissions are world
readable.
</p></li>
</ol></li>
<li>Run <code>ssh worf</code>. Congratuations, you now have a SSH session on the
best iOS client available at this time.</li>
<li>To use mosh, ensure mosh is installed on the server.<sup><a id="fnr.8" class="footref" href="#fn.8">8</a></sup> Then
run <code>mosh worf</code>.</li>
</ol>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.panic.com/prompt/">Prompt 2 Homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="http://www.blink.sh/">Blink Shell Homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.droidfonts.com/info/droid-sans-mono-fonts/">Droid Sans Mono Homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
<a href="https://mosh.org/">Mosh Homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
<a href="https://github.com/blinksh/blink">Blink on GitHub</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara">
<a href="https://apple.stackexchange.com/a/59495/140932">Ask Different: Is it possible to have GPL software in the Mac App Store?</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7">7</a></sup> <div class="footpara"><p class="footpara">
<a href="https://github.com/blinksh/blink#using-blink">README ยง Using Blink</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8">8</a></sup> <div class="footpara"><p class="footpara">
<a href="https://mosh.org/#getting">Getting Mosh</a>
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags</a>: <a href="tag-computing.html">computing</a> </div>
<div class="post-date">13 Jan 2019</div><h1 class="post-title"><a href="2019-01-13-gnu-c-style.html">GNU C Style</a></h1>
<p>
No. Do not use it please! There are far easier-to-read and easier-to-use styles
for C!<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>


<figure>
<img src="static/image/gnu-comic.png" alt="gnu-comic.png">

</figure>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://en.wikipedia.org/wiki/Indentation_style">Indentation Style on Wikipedia</a>
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags</a>: <a href="tag-computing.html">computing</a> <a href="tag-rant.html">rant</a> </div>
<div class="post-date">11 Jan 2019</div><h1 class="post-title"><a href="2019-01-11-publishing-with-org-static-blog.html">Publishing with org-static-blog</a></h1>

<div id="outline-container-orgc3ae62a" class="outline-2">
<h2 id="orgc3ae62a">Criteria</h2>
<div class="outline-text-2" id="text-orgc3ae62a">
<p>
After reviewing a list of org-mode<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> capable static website generators<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>,
I decided to see if org-static-blog<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> could suffice my simple
needs. My criteria for choosing an org-mode static site generator was:
</p>

<ul class="org-ul">
<li>it must be actively maintained,</li>
<li>it must be simple to set up with customizations,</li>
<li>and it must work with Emacs 26 and later.</li>
</ul>

<p>
This ruled out quite a few right away. I didn't attempt using
org-publish, as it looked like a great deal of configuration to
achieve a minimum viable web-page for this project.
</p>
</div>
</div>

<div id="outline-container-orga861f68" class="outline-2">
<h2 id="orga861f68">Configuration of <code>org-static-blog</code></h2>
<div class="outline-text-2" id="text-orga861f68">
<p>
Following the org-static-blog README documentation, it is very
straight forward to get a minimal viable website generated. I added
the following to my <code>init.el</code>:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(add-to-list 'auto-mode-alist (cons (concat org-static-blog-posts-directory <span style="color: #2d9574;">".*\\.org\\'"</span>) 'org-static-blog-mode))
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-publish-title <span style="color: #2d9574;">"blog.winny.tech"</span>)
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-publish-url <span style="color: #2d9574;">"https://blog.winny.tech/"</span>)
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-publish-directory <span style="color: #2d9574;">"~/projects/blog/"</span>)
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-posts-directory <span style="color: #2d9574;">"~/projects/blog/posts/"</span>)
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-drafts-directory <span style="color: #2d9574;">"~/projects/blog/drafts/"</span>)
(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-enable-tags t)

(<span style="color: #3a81c3; font-weight: bold;">setq</span> org-static-blog-page-header
      <span style="color: #2d9574;">"</span>
<span style="color: #2d9574;">&lt;link href=\"static/style.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;</span>
<span style="color: #2d9574;">"</span>)
</pre>
</div>

<p>
I opted to <code>setq</code> all the configuration variables; I will likely
switch to using <code>M-x customize-group RET org-static-blog RET</code> in the
future however. It's a better experience.
</p>

<p>
Then I simply create a new post with
<code>M-x org-static-blog-create-new-post RET &lt;TITLE&gt; RET</code>, edit the
buffer, save it, then run <code>M-x org-static-blog-publish RET</code>.
I also added some styling to my <code>style.css</code><sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup> based off the Tachyons CSS
framework<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup>. I had previously used Bootstrap<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup> for styling but was hoping
to avoid adding framework and other extra tooling that shouldn't
be necessary to generate a simple site like this one.
</p>
</div>
</div>

<div id="outline-container-orgad182b0" class="outline-2">
<h2 id="orgad182b0">Deploying with Caddy and GitHub</h2>
<div class="outline-text-2" id="text-orgad182b0">
<p>
I am a fan of the Caddy<sup><a id="fnr.7" class="footref" href="#fn.7">7</a></sup> web server which offers automatic HTTPS
via LetsEncrypt with only a few lines of configuration. In addition
Caddy has a plugin named git which offers the ability to
automatically deploy content from git repositories with webhook
support. To deploy the following steps are taken:
</p>

<ol class="org-ol">
<li><code>M-x org-static-blog-publish RET</code> from Emacs to regenerate the
static site,</li>
<li>commit the changes in git,</li>
<li>and finally push the git branch to GitHub.</li>
</ol>

<p>
After these steps, GitHub automatically sends a HTTP POST request to my Caddy
server with information about the new git commits and Caddy pulls the
git repository. If everything went well and the webhook successfully
fired, the website is now deployed.
</p>
</div>

<div id="outline-container-org08c0480" class="outline-3">
<h3 id="org08c0480">Server Configuration</h3>
<div class="outline-text-3" id="text-org08c0480">
<p>
I switched most of my personal internet-related services to Docker<sup><a id="fnr.8" class="footref" href="#fn.8">8</a></sup> in
conjunction with <code>docker-compose</code><sup><a id="fnr.9" class="footref" href="#fn.9">9</a></sup> last year. The main rationale
is I can move my configuration without dealing with systems package
versions.  I already had Caddy set up,
so it was as simple as adding this to my <code>Caddyfile</code>:
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="color: #ba2f59; font-weight: bold;">blog.winny.tech</span> {
        root /srv/www/blog.winny.tech
        gzip
        log /logs/blog.winny.tech.log
        git https://github.com/winny-/blog.winny.tech {
                hook /webhook top-secret-password-redacted
        }
}
</pre>
</div>

<p>
The relevant lines of my <code>docker-compose.yml</code> looks like this:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #715ab1;">version</span>: <span style="color: #2d9574;">"2.1"</span>
<span style="color: #715ab1;">services</span>:
  <span style="color: #715ab1;">web</span>:
    <span style="color: #715ab1;">image</span>: abiosoft/caddy:no-stats
    <span style="color: #715ab1;">ports</span>:  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Expose the webserver ports to the internet</span>
      - <span style="color: #2d9574;">"80:80"</span>
      - <span style="color: #2d9574;">"443:443"</span>
    <span style="color: #715ab1;">environment</span>:
      <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">This is where caddy places certs after ACME negotiation.</span>
      <span style="color: #715ab1;">CADDYPATH</span>: <span style="color: #2d9574;">"/etc/caddycerts"</span>
      <span style="color: #715ab1;">ACME_AGREE</span>: <span style="color: #2d9574;">"true"</span>
    <span style="color: #715ab1;">volumes</span>:
      - /srv/caddy/certs:/etc/caddycerts
      - /srv/caddy/Caddyfile:/etc/Caddyfile  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Configuration</span>
      - /srv/www:/srv/www  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the websites</span>
      - /srv/caddy/logs:/logs
</pre>
</div>

<p>
A keen <code>docker-compose</code>-savy reader will notice I did not specify a
<code>restart: always</code> entry. I had Caddy configured to always restart,
however, when requesting new HTTPS certificates from LetsEncrypt, there
is a tendency to misconfigure the domain configuration or Caddyfile,
and if Caddy requests too many HTTPS certificates in a short amount of
time, LetsEcrypt will rate-limit my future requests. Usually this is
only requires an hour or two of waiting, but is frustrating to deal
with when trying to fix my configuration. Instead I rather Caddy
exit after failing to activate all the domains and fix my
configuration first.
</p>
</div>
</div>

<div id="outline-container-orge7f5504" class="outline-3">
<h3 id="orge7f5504">GitHub Configuration</h3>
<div class="outline-text-3" id="text-orge7f5504">
<p>
Simply create the GitHub repository, then add a webhook. It is
important to note the webhook <i>must</i> send a JSON payload. By default a
newly created webhook will send a <code>application/x-www-form-urlencoded</code>
payload and will not work.
</p>
</div>
</div>
</div>

<div id="outline-container-org56ea7ec" class="outline-2">
<h2 id="org56ea7ec">Conclusion</h2>
<div class="outline-text-2" id="text-org56ea7ec">
<p>
With this simple setup I can write posts. I can easily move the
configuration to a new host at will. In addition my setup does not
depend on future use of GitHub as GitLab, Gogs, and other git hosts
offer webhook support in the same way. Most importantly, I can author
org-mode files and have a better balance between features and ease of
use than what markdown offers.
</p>

<p>
Web dev is one of my least
favorite programming exercises. Between all the testing necessary to
ensure a simple site works across many platforms, the trend to use a
very complex system such as webpack and many other tools to produce
simple websites, and the perpetual flux-and-flow between vendors only
partially implementing good features, web dev just doesn't do it for
me. Hence, I am very pleased how simple this project turned out to
be.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://orgmode.org/">org-mode homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://orgmode.org/worg/org-blog-wiki.html">Blogs and Wikis with Org</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<a href="https://github.com/bastibe/org-static-blog/">org-static-blog on GitHub</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
<a href="static/style.css"><code>static/style.css</code></a>
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
<a href="http://tachyons.io/">Tachyons homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara">
<a href="https://getbootstrap.com/">Bootstrap framework homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7">7</a></sup> <div class="footpara"><p class="footpara">
<a href="https://caddyserver.com/">Caddy webserver homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8">8</a></sup> <div class="footpara"><p class="footpara">
<a href="https://docs.docker.com/engine/">Docker Engine homepage</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.9" class="footnum" href="#fnr.9">9</a></sup> <div class="footpara"><p class="footpara">
<a href="https://docs.docker.com/compose/overview/"><code>docker-compose</code> homepage</a>
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags</a>: <a href="tag-computing.html">computing</a> </div><div id="archive">
<a href="archive.html">Other posts</a>
</div>
</div>
</body>
</html>
